function U(s){let i=[{start:s.buffer.byteLength/2,size:s.buffer.byteLength/2}],u=new Map,P=[],w=[];function g(){return i}function d(){return u}function h(e){let n=0;for(;n<i.length&&i[n].start<e.start;)n++;i.splice(n,0,e)}let o;function p(e){o===void 0?o=e:(w.push({first:o,second:e}),o=void 0)}function S(){if(!w.length)return[0,0];let e=w.pop();return[e.first,e.second]}function V(){if(w.length<2)return[0,0];let[e]=w.splice(w.length-2,1);return[e.first,e.second]}function T(e){let n=u.get(e);if(!n)throw new Error("Invalid pointer: "+e);let t=f(n.size),c=new Uint8Array(s.buffer,e,n.size);return new Uint8Array(s.buffer,t,n.size).set(c),t}function a(){let e=Array.from(u.entries());if(e.length<2)return;let[n,t]=e[e.length-2],[c,r]=e[e.length-1],z={...t,size:t.size+r.size};u.delete(c),u.set(n,z)}function f(e){for(let t=0;t<i.length;t++)if(i[t].size>=e){let c=i.splice(t,1);if(c.length>0){let r=c[0];if(r.size>e){let z={start:r.start+e,size:r.size-e};h(z)}return r.size=e,u.set(r.start,r),r.start}}if(s.buffer.byteLength+e>s.buffer.byteLength*s.buffer.byteLength/65536){let t=Math.ceil(e/65536);s.grow(t)}let n={start:s.buffer.byteLength,size:e};return u.set(n.start,n),n.start}function l(e){let n=u.get(e);if(!n){console.error("Unable to find block");return}u.delete(e);for(let t=0;t<i.length;t++)i[t].start+i[t].size===n.start?(n.start=i[t].start,n.size+=i[t].size,i.splice(t,1),t--):n.start+n.size===i[t].start&&(n.size+=i[t].size,i.splice(t,1),t--);h(n)}function y(e){return P.find(n=>n.dataPtr===e)}function A(e){let n=f(4*e).start,t={dataPtr:n,length:0,capacity:4,elementTypeSize:e};return P.push(t),n}function b(e,n){let t=y(e);if(!t)throw new Error("Vector not found");if(t.length>=t.capacity){let r=t.dataPtr;t.dataPtr=f(2*t.capacity*t.elementTypeSize).start,t.capacity*=2;let z=new Uint8Array(s.buffer,r,t.length*t.elementTypeSize);new Uint8Array(s.buffer,t.dataPtr,t.capacity*t.elementTypeSize).set(z),l(r)}let c=new Uint8Array(s.buffer,t.dataPtr+t.length*t.elementTypeSize,t.elementTypeSize);for(let r=0;r<t.elementTypeSize;r++)c[r]=n>>r*8&255;t.length+=1}function L(e,n=4){let t=f(n),c=new Uint8Array(s.buffer,t.start,n);for(let r=0;r<n;r++)c[r]=e>>r*8&255;return t.start}function k(e,n=4){let t=new Uint8Array(s.buffer,e,n),c=0;for(let r=0;r<n;r++)c|=t[r]<<r*8;return c}return{alloc:f,dealloc:l,merge:a,save:p,undo:S,undoPenultimate:V,createVector:A,pushToVector:b,allocateValue:L,readValue:k,getFreeList:g,getUsedBlocks:d,copy:T}}function I(s,i=void 0){let g=[],d="default",h,o,p;function S(a,f){let l=new Int32Array(s.buffer,a,f);return Array.from(l)}function V(a,f){let l=new Uint8Array(s.buffer,a,f*4),y="";for(let A=0;A<l.length;A+=4){let b=l[A];b>=32&&b<=126?y+=String.fromCharCode(b):y+=b.toString()}return y}function T(a){if(a===777777){if(g.length>0){let f=g.join(" ");if(i){let l=document.createElement("p");l.innerHTML=f,i.appendChild(l)}else console.log(f);g=[]}return}if(d==="default"){if(a===999999){d="array",h=void 0,o=void 0;return}if(a===888888){d="string",p=void 0,o=void 0;return}g.push(a)}else if(d==="array"){if(!o){o=a;return}if(!h){h=a;let f=S(h,o);g.push(f),h=void 0,o=void 0,d="default"}}else if(d==="string"){if(!o){o=a;return}if(!p){p=a;let f=V(p,o);g.push(f),p=void 0,o=void 0,d="default"}}}return{draw:T,receiveParams:T,readArrayFromMemory:S}}export{I as createDrawer,U as createMemoryManager};
