function U(s){let r=[{start:s.buffer.byteLength/2,size:s.buffer.byteLength/2}],u=new Map,w=[],d=[];function g(){return r}function h(){return u}function l(t){let n=0;for(;n<r.length&&r[n].start<t.start;)n++;r.splice(n,0,t)}let p;function b(t){p===void 0?p=t:(d.push({first:p,second:t}),p=void 0)}function y(){if(!d.length)return[0,0];let t=d.pop();return[t.first,t.second]}function A(){if(d.length<2)return[0,0];let[t]=d.splice(d.length-2,1);return[t.first,t.second]}function a(t){let n=u.get(t);if(!n)throw new Error("Invalid pointer: "+t);let e=c(n.size),o=new Uint8Array(s.buffer,t,n.size);return new Uint8Array(s.buffer,e,n.size).set(o),e}function f(){let t=Array.from(u.entries());if(t.length<2){console.error("Not enough entries to merge.");return}let[n,e]=t[t.length-2],[o,i]=t[t.length-1],T={...e,size:e.size+i.size};u.delete(o),u.set(n,T)}function c(t){for(let e=0;e<r.length;e++)if(r[e].size>=t){let o=r.splice(e,1)[0];if(o.size>t){let i={start:o.start+t,size:o.size-t};l(i)}return o.size=t,u.set(o.start,o),o.start}if(s.buffer.byteLength+t>s.buffer.byteLength*s.buffer.byteLength/65536){let e=Math.ceil(t/65536);s.grow(e)}let n={start:s.buffer.byteLength,size:t};return u.set(n.start,n),n.start}function P(t){let n=u.get(t);if(!n){console.error("Unable to find block");return}u.delete(t);for(let e=0;e<r.length;e++)r[e].start+r[e].size===n.start?(n.start=r[e].start,n.size+=r[e].size,r.splice(e,1),e--):n.start+n.size===r[e].start&&(n.size+=r[e].size,r.splice(e,1),e--);l(n)}function z(t){return w.find(n=>n.dataPtr===t)}function V(t){let n=c(4*t).start,e={dataPtr:n,length:0,capacity:4,elementTypeSize:t};return w.push(e),n}function S(t,n){let e=z(t);if(!e)throw new Error("Vector not found");if(e.length>=e.capacity){let i=e.dataPtr;e.dataPtr=c(2*e.capacity*e.elementTypeSize).start,e.capacity*=2;let T=new Uint8Array(s.buffer,i,e.length*e.elementTypeSize);new Uint8Array(s.buffer,e.dataPtr,e.capacity*e.elementTypeSize).set(T),P(i)}let o=new Uint8Array(s.buffer,e.dataPtr+e.length*e.elementTypeSize,e.elementTypeSize);for(let i=0;i<e.elementTypeSize;i++)o[i]=n>>i*8&255;e.length+=1}function L(t,n=4){let e=c(n),o=new Uint8Array(s.buffer,e.start,n);for(let i=0;i<n;i++)o[i]=t>>i*8&255;return e.start}function k(t,n=4){let e=new Uint8Array(s.buffer,t,n),o=0;for(let i=0;i<n;i++)o|=e[i]<<i*8;return o}return{alloc:c,dealloc:P,merge:f,save:b,undo:y,undoPenultimate:A,createVector:V,pushToVector:S,allocateValue:L,readValue:k,getFreeList:g,getUsedBlocks:h,copy:a}}function M(s,r=void 0){let d=[],g="default",h,l,p;function b(a,f){let c=new Int32Array(s.buffer,a,f);return Array.from(c)}function y(a,f){let c=new Uint8Array(s.buffer,a,f*4);return new TextDecoder().decode(c)}function A(a){if(g==="default"){if(a===999999){g="array",d.pop();return}if(a===888888){g="string",d.pop();return}if(r){let f=document.createElement("p");f.innerHTML=a,r.appendChild(f)}else console.log(a)}else if(g==="array"){if(!h){h=a;return}if(!l){l=a;let f=b(h,l);if(r){let c=document.createElement("p");c.innerHTML=f,r.appendChild(c)}else console.log(f);h=void 0,l=void 0,g="default"}}else if(g==="string"){if(!l){l=a;return}if(!p){p=a;let f=y(p,l);if(r){let c=document.createElement("p");c.innerHTML=f,r.appendChild(c)}else console.log(f);p=void 0,l=void 0,g="default"}}}return{receiveParams:A}}export{M as createDrawer,U as createMemoryManager};
